import{a as V,c as T,e as F,i as I,l as g}from"/_shared/chunk-Q65RRHJI.js";import{b as _,c as l}from"/_shared/chunk-HSAVHZGQ.js";var z=_((Z,O)=>{O.exports={}});var t=l(V(),1);var e=l(g(),1);function N(){let{defaultModelName:L}=I(),[c,D]=(0,t.useState)([]),[p,x]=(0,t.useState)(""),[j,h]=(0,t.useState)(!1),[d,y]=(0,t.useState)(!1),[f,K]=(0,t.useState)(L||""),b=T(),v=(0,t.useRef)(null),m=(0,t.useRef)(null),M=(0,t.useRef)(null),S=(0,t.useRef)(!1);(0,t.useEffect)(()=>{!S.current&&m.current&&(m.current.focus(),S.current=!0),!d&&m.current&&c.length>0&&m.current.focus()},[d,c.length]);let W=async s=>{s.preventDefault();let w=new FormData(s.currentTarget).get("message");if(!w?.trim())return;let k={role:"user",content:w};D(r=>[...r,k]),v.current?.reset(),h(!0),y(!0);try{let r=await fetch("/api/v1/chat/stream",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:[...c,k],temperature:.7,stream:!0,model:f})});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);let R=r.body?.getReader(),H=new TextDecoder,i="";if(!R)return;let C=!1;for(;;){let{done:J,value:P}=await R.read();if(J){i.trim()&&D(u=>[...u,{role:"assistant",content:i.trim()}]),x(""),y(!1);break}C||(h(!1),C=!0);let U=H.decode(P).split(`
`);for(let u of U){if(!u.trim()||!u.startsWith("data:"))continue;let E=u.slice(5).trim();if(E!=="[DONE]")try{let a=JSON.parse(E);a.message?.content&&(i===""?i+=a.message.content.trimStart():i+=a.message.content,x(i)),a.model&&f!==a.model&&K(a.model)}catch(a){console.error("Failed to parse chunk:",a)}}}}catch(r){console.error("Error:",r),x("Error: Failed to get response"),h(!1),y(!1)}},$=s=>{if(s.key==="Enter"&&!s.shiftKey){s.preventDefault();let n=v.current;n&&n.querySelector("textarea")?.value.trim()&&n.requestSubmit()}};(0,t.useEffect)(()=>{M.current?.scrollIntoView({behavior:"smooth"})},[c,p]);let q=s=>s.trim();return(0,e.jsxs)("div",{className:"flex flex-col h-full min-h-[calc(100vh-120px)]",children:[(0,e.jsxs)("div",{className:"flex-1 p-4 md:p-6 overflow-y-auto space-y-4 bg-gray-50",children:[c.map((s,n)=>(0,e.jsx)("div",{className:`flex ${s.role==="user"?"justify-end":"justify-start"}`,children:(0,e.jsx)("div",{className:`max-w-[85%] rounded-2xl px-4 py-3 ${s.role==="user"?"bg-blue-600 text-white":"bg-gray-100 text-gray-900"}`,children:(0,e.jsx)("div",{className:"whitespace-pre-wrap",children:q(s.content)})})},n)),j&&(0,e.jsx)("div",{className:"flex justify-start",children:(0,e.jsx)("div",{className:"max-w-[85%] rounded-2xl px-4 py-3 bg-gray-100 text-gray-900",children:(0,e.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,e.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),(0,e.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),(0,e.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})})}),p&&(0,e.jsx)("div",{className:"flex justify-start",children:(0,e.jsx)("div",{className:"max-w-[85%] rounded-2xl px-4 py-3 bg-gray-100 text-gray-900",children:(0,e.jsx)("div",{className:"whitespace-pre-wrap",children:p})})}),(0,e.jsx)("div",{ref:M})]}),(0,e.jsx)("div",{className:"border-t p-3 bg-white sticky bottom-0 left-0 right-0 z-10 shadow-md",children:(0,e.jsx)(F,{ref:v,onSubmit:W,className:"flex flex-col space-y-2",children:(0,e.jsxs)("div",{className:"flex gap-2",children:[(0,e.jsx)("textarea",{ref:m,name:"message",rows:1,className:"flex-1 rounded-xl border-gray-200 shadow-sm focus:border-blue-500 focus:ring-blue-500 resize-none px-3 py-2",placeholder:"Type your message...",disabled:b.state==="submitting"||d,onKeyDown:$,autoFocus:!0,style:{overflow:"hidden",minHeight:"40px"}}),(0,e.jsx)("button",{type:"submit",disabled:b.state==="submitting"||d,className:"px-4 py-2 bg-blue-600 text-white rounded-xl hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 font-medium transition-colors disabled:opacity-50 whitespace-nowrap",children:d?"Thinking...":b.state==="submitting"?"Sending...":"Send"})]})})}),f&&(0,e.jsxs)("div",{className:"text-center text-xs text-gray-500 py-1 bg-gray-100 sticky bottom-0 left-0 right-0 z-0",children:["Using model: ",(0,e.jsx)("span",{className:"font-medium",children:f})]})]})}var B=l(z(),1),o=l(g(),1),G=()=>[{title:"AI Chatbot on DMR"},{description:"AI Chatbot on Docker Model Runner"}];function A(){return(0,o.jsxs)("div",{className:"min-h-screen flex flex-col bg-gray-100",children:[(0,o.jsx)("header",{className:"py-3 bg-white shadow fixed top-0 left-0 right-0 z-20",children:(0,o.jsx)("h1",{className:"text-xl md:text-2xl font-bold text-center",children:"AI Chatbot on Docker Model Runner"})}),(0,o.jsx)("main",{className:"flex-1 w-full max-w-5xl mx-auto px-4 pt-14 pb-2 flex flex-col",children:(0,o.jsx)(N,{})})]})}export{A as default,G as meta};
