import{r,u as M,j as e,F as O}from"./components-Druq3HpN.js";function A(){const[c,p]=r.useState([]),[d,u]=r.useState(""),[E,m]=r.useState(!1),[f,x]=r.useState(!1),g=M(),h=r.useRef(null),y=r.useRef(null),k=async s=>{var j,w,v;s.preventDefault();const t=new FormData(s.currentTarget).get("message");if(!(t!=null&&t.trim()))return;const b={role:"user",content:t};p(a=>[...a,b]),(j=h.current)==null||j.reset(),m(!0),x(!0);try{const a=await fetch("/api/v1/chat/stream",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:[...c,b],model:"mistral",temperature:.7,stream:!0})});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const N=(w=a.body)==null?void 0:w.getReader(),I=new TextDecoder;let o="";if(!N)return;let S=!1;for(;;){const{done:R,value:C}=await N.read();if(R){o.trim()&&p(i=>[...i,{role:"assistant",content:o}]),u(""),x(!1);break}S||(m(!1),S=!0);const F=I.decode(C).split(`
`);for(const i of F){if(!i.trim()||!i.startsWith("data:"))continue;const D=i.slice(5).trim();if(D!=="[DONE]")try{const l=JSON.parse(D);(v=l.message)!=null&&v.content&&(o+=l.message.content,u(o))}catch(l){console.error("Failed to parse chunk:",l)}}}}catch(a){console.error("Error:",a),u("Error: Failed to get response"),m(!1),x(!1)}},T=s=>{if(s.key==="Enter"&&!s.shiftKey){s.preventDefault();const n=h.current;if(n){const t=n.querySelector("textarea");t!=null&&t.value.trim()&&n.requestSubmit()}}};return r.useEffect(()=>{var s;(s=y.current)==null||s.scrollIntoView({behavior:"smooth"})},[c,d]),e.jsxs("div",{className:"flex flex-col h-[calc(100vh-200px)] bg-gray-50",children:[e.jsxs("div",{className:"flex-1 p-6 overflow-y-auto space-y-6",children:[c.map((s,n)=>e.jsx("div",{className:`flex ${s.role==="user"?"justify-end":"justify-start"}`,children:e.jsx("div",{className:`max-w-[80%] rounded-2xl px-4 py-3 ${s.role==="user"?"bg-blue-600 text-white":"bg-gray-100 text-gray-900"}`,children:e.jsx("div",{className:"whitespace-pre-wrap",children:s.content})})},n)),E&&e.jsx("div",{className:"flex justify-start",children:e.jsx("div",{className:"max-w-[80%] rounded-2xl px-4 py-3 bg-gray-100 text-gray-900",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})})}),d&&e.jsx("div",{className:"flex justify-start",children:e.jsx("div",{className:"max-w-[80%] rounded-2xl px-4 py-3 bg-gray-100 text-gray-900",children:e.jsx("div",{className:"whitespace-pre-wrap",children:d})})}),e.jsx("div",{ref:y})]}),e.jsx("div",{className:"border-t p-6",children:e.jsxs(O,{ref:h,onSubmit:k,className:"space-y-4",children:[e.jsx("textarea",{name:"message",rows:3,className:"w-full rounded-2xl border-gray-200 shadow-sm focus:border-blue-500 focus:ring-blue-500 resize-none px-4 py-3",placeholder:"Type your message...",disabled:g.state==="submitting"||f,onKeyDown:T}),e.jsx("button",{type:"submit",disabled:g.state==="submitting"||f,className:"w-full bg-blue-600 text-white px-4 py-3 rounded-xl hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 font-medium transition-colors disabled:opacity-50",children:f?"Thinking...":g.state==="submitting"?"Sending...":"Send Message"})]})})]})}const $=()=>[{title:"AI Chat"},{description:"Chat with an AI assistant"}];function q(){return e.jsx("div",{className:"min-h-screen bg-gray-100 py-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4",children:[e.jsx("h1",{className:"text-3xl font-bold text-center mb-8",children:"AI Chat"}),e.jsx(A,{})]})})}export{q as default,$ as meta};
